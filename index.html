<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>OpenMC-Skin Upload</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  background:#0f0f0f;
  color:white;
  font-family:Arial, sans-serif;
  text-align:center;
}

#dropzone {
  border:3px dashed #555;
  padding:40px;
  margin:20px auto;
  width:400px;
  cursor:pointer;
}

#dropzone.dragover {
  border-color:#00ffcc;
}

input, button {
  padding:10px;
  margin:5px;
}

#gallery {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
}

.skin {
  margin:10px;
}

.skin img {
  width:128px;
  height:128px;
  image-rendering:pixelated;
  border:1px solid #333;
}
</style>
</head>

<body>

<h1>OpenMC-Skin Upload</h1>

<div id="dropzone">
  <p>Datei hier reinziehen<br>ODER klicken</p>
  <input type="file" id="fileInput" accept="image/png" hidden>
  <input type="text" id="nameInput" placeholder="Skin-Name">
  <br>
  <button onclick="uploadSkin()">Hochladen</button>
</div>

<div id="gallery"></div>

<script>
const supabaseUrl = "https://iomomoktrjlhqoeoavkb.supabase.co";
const supabaseKey = "sb_publishable_q1BzzFtE0bFieXJtPD6Sng_lZQXC740";
const bucketName = "skins";

const supabase = supabase.createClient(supabaseUrl, supabaseKey);

const dropzone = document.getElementById("dropzone");
const fileInput = document.getElementById("fileInput");

dropzone.addEventListener("click", () => fileInput.click());

dropzone.addEventListener("dragover", e => {
  e.preventDefault();
  dropzone.classList.add("dragover");
});

dropzone.addEventListener("dragleave", () => {
  dropzone.classList.remove("dragover");
});

dropzone.addEventListener("drop", e => {
  e.preventDefault();
  dropzone.classList.remove("dragover");
  fileInput.files = e.dataTransfer.files;
});

async function uploadSkin() {
  const file = fileInput.files[0];
  const name = document.getElementById("nameInput").value || file?.name;

  if (!file) {
    alert("Keine Datei ausgewÃ¤hlt");
    return;
  }

  const filePath = `${Date.now()}_${name}.png`;

  const { error } = await supabase
    .storage
    .from(bucketName)
    .upload(filePath, file);

  if (error) {
    alert("Upload-Fehler: " + error.message);
    return;
  }

  fileInput.value = "";
  document.getElementById("nameInput").value = "";

  loadSkins();
}

async function loadSkins() {
  const { data, error } = await supabase
    .storage
    .from(bucketName)
    .list();

  if (error) return;

  const gallery = document.getElementById("gallery");
  gallery.innerHTML = "";

  data.forEach(file => {
    const url = supabase
      .storage
      .from(bucketName)
      .getPublicUrl(file.name).data.publicUrl;

    gallery.innerHTML += `
      <div class="skin">
        <img src="${url}">
        <br>
        <a href="${url}" download>Download</a>
      </div>
    `;
  });
}

loadSkins();
</script>

</body>
</html>
