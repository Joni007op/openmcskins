<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage.js"></script>

<script>
    // Firebase-Konfiguration
    const firebaseConfig = {
      apiKey: "AIzaSyCEWwlte3qYS8ExxbTorufLDMzHjxxsZ94",
      authDomain: "openmc-skins.firebaseapp.com",
      projectId: "openmc-skins",
      storageBucket: "openmc-skins.appspot.com",
      messagingSenderId: "97231924615",
      appId: "1:97231924615:web:6271d12ce917699f68f722"
    };

    // Firebase initialisieren (modular v9)
    const app = firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();

    const fileInput = document.getElementById('fileInput');
    const skinNameInput = document.getElementById('skinName');
    const gallery = document.getElementById('gallery');
    const searchInput = document.getElementById('searchInput');

    // Upload-Funktion
    fileInput.addEventListener('change', async () => {
        const file = fileInput.files[0];
        const name = skinNameInput.value.trim() || file.name;
        if (!file) return alert('Keine Datei ausgewÃ¤hlt');

        try {
            const storageRef = storage.ref('skins/' + name);
            await storageRef.put(file); // Upload starten
            alert('Skin hochgeladen!');
            fileInput.value = '';
            skinNameInput.value = '';
            loadGallery(); // Galerie aktualisieren
        } catch (error) {
            console.error(error);
            alert('Upload fehlgeschlagen!');
        }
    });

    // Galerie laden
    async function loadGallery() {
        gallery.innerHTML = '';
        const listRef = storage.ref('skins');
        try {
            const res = await listRef.listAll();
            res.items.forEach(async (itemRef) => {
                const url = await itemRef.getDownloadURL();
                const name = itemRef.name;

                const card = document.createElement('div');
                card.className = 'skin-card';

                const img = document.createElement('img');
                img.src = url;
                card.appendChild(img);

                const title = document.createElement('div');
                title.textContent = name;
                card.appendChild(title);

                const downloadBtn = document.createElement('button');
                downloadBtn.textContent = 'Download';
                downloadBtn.onclick = () => { window.open(url, '_blank'); };
                card.appendChild(downloadBtn);

                gallery.appendChild(card);
            });
        } catch (err) {
            console.error(err);
        }
    }

    // Suche
    searchInput.addEventListener('input', () => {
        const filter = searchInput.value.toLowerCase();
        Array.from(gallery.children).forEach(card => {
            const name = card.querySelector('div').textContent.toLowerCase();
            card.style.display = name.includes(filter) ? '' : 'none';
        });
    });

    // Galerie initial laden
    loadGallery();
</script>
